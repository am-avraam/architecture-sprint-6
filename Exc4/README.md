# Архитектурное решение для продажи ОСАГО

## 1. Реализация osago-aggregator

### Хранилище данных
Сервису требуется собственное хранилище данных (osago-db) для:
- Хранения заявок клиентов и их статусов
- Сохранения предложений от страховых компаний
- Отслеживания состояния запросов и таймаутов
- Обеспечения отказоустойчивости при сбоях

### API для core-app
- **Создание заявки:**
  ```
  POST /api/v1/applications
  ```
  - Принимает данные о клиенте и автомобиле
  - Возвращает идентификатор заявки

- **Получение предложений:**
  ```
  WebSocket /api/v1/applications/{id}/offers
  ```
  - Стриминг предложений по мере их поступления
  - Поддержка real-time обновлений

## 2. Интеграция между сервисами

### core-app и osago-aggregator
- WebSocket для real-time получения предложений
- Позволяет получать предложения сразу после их поступления
- Снижает нагрузку на сеть по сравнению с polling

### Веб-приложение и core-app
- WebSocket для трансляции предложений клиенту
- Обеспечивает мгновенное отображение новых предложений
- Эффективно работает с множеством одновременных подключений

## 3. Применение паттернов отказоустойчивости

### Rate Limiting (в core-app)
- Ограничение количества запросов от партнеров
- Защита от перегрузки системы
- Обеспечение SLA для всех клиентов

### Circuit Breaker (в osago-aggregator)
- Защита от каскадных отказов при проблемах со страховыми компаниями
- Быстрый отказ вместо длительного ожидания
- Автоматическое восстановление соединения

### Retry (в osago-aggregator)
- Повторные попытки при временных сбоях страховых компаний
- Экспоненциальная задержка между попытками
- Ограничение максимального числа попыток

### Timeout (в osago-aggregator)
- 60-секундный таймаут на ожидание ответа
- Прекращение ожидания при превышении лимита
- Освобождение ресурсов системы

## 4. Масштабирование

### Горизонтальное масштабирование
- Все сервисы развернуты в нескольких экземплярах
- WebSocket соединения распределяются между инстансами
- Состояние хранится в базе данных

### Отказоустойчивость
- Репликация баз данных
- Балансировка нагрузки между инстансами
- Graceful degradation при частичных сбоях
